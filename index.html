<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8"&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</p>
<p class="p1">&lt;title&gt;Motor Working Memory – Delayed Reach (iPad Stylus)&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>html, body { margin:0; padding:0; height:100%; background:#fafafa; font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>#ui { padding: 12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; background:#fff; border-bottom:1px solid #ddd; position:sticky; top:0; z-index:2;}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#status { font-size:14px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>label { font-size:14px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>input, select { padding:6px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>button { padding:8px 12px; border:1px solid #ccc; background:#fff; border-radius:6px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>#canvasWrap { position:relative; width:100%; height:calc(100% - 58px); display:flex; justify-content:center; align-items:center; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pad { touch-action: none; background:#fff; border:1px solid #ddd; border-radius: 12px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>#overlay { position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:left; padding:20px; background:rgba(255,255,255,0.94); font-size:18px; line-height:1.45;}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#probeGrid { display:grid; grid-template-columns: repeat(4, 40px); gap:8px; justify-content:center; margin-top:12px;}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.sq { width:40px; height:40px; border:1px solid #666; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>#motorTapArea { margin-top:12px; display:flex; gap:8px; justify-content:center;}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.tapbtn { width:60px; height:60px; border-radius:50%; border:1px solid #444; background:#eee; font-size:18px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.note { font-size:14px; color:#555; }</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div id="ui"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;label&gt;Participant ID: &lt;input id="pid" placeholder="e.g., S01" style="width:90px;"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button id="startBtn"&gt;Start block (toolbar settings)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button id="downloadBtn" disabled&gt;Download CSV&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;label&gt;Condition mix:</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;select id="condMix"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="all"&gt;All (random per trial)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="baseline"&gt;Baseline only&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="verbal"&gt;Verbal only&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="vis"&gt;Visuospatial only&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="motor"&gt;Motor only&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;label&gt;Delay (s):</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;select id="delaySel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option&gt;3&lt;/option&gt;&lt;option selected&gt;4&lt;/option&gt;&lt;option&gt;5&lt;/option&gt;&lt;option&gt;6&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;label&gt;Trials per block:</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;select id="nTrialsSel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option&gt;10&lt;/option&gt;&lt;option&gt;16&lt;/option&gt;&lt;option selected&gt;20&lt;/option&gt;&lt;option&gt;24&lt;/option&gt;&lt;option&gt;32&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;span id="status"&gt;Idle&lt;/span&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div id="canvasWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;canvas id="pad" width="900" height="900"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="overlay"&gt;&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">// ====== Config ======</p>
<p class="p1">const R_HOME = 14; <span class="Apple-converted-space">                </span>// home marker radius (px)</p>
<p class="p1">const R_THRESH = 120;<span class="Apple-converted-space">              </span>// radius at which we take angle (px)</p>
<p class="p1">const TARGET_RADIUS = 220; <span class="Apple-converted-space">        </span>// target distance from center (px)</p>
<p class="p1">const TARGET_MS = 400; <span class="Apple-converted-space">            </span>// target flash duration (ms)</p>
<p class="p1">const RETURN_MS = 500; <span class="Apple-converted-space">            </span>// return-to-center pause (ms)</p>
<p class="p1">const TRIALS_PER_BLOCK_DEFAULT = 20;</p>
<p class="p1">const ANGLES = Array.from({length:16}, (_,i)=&gt; i* (360/16)); // 16 evenly spaced directions</p>
<p class="p2"><br></p>
<p class="p1">// ====== State ======</p>
<p class="p1">const canvas = document.getElementById('pad');</p>
<p class="p1">const ctx = canvas.getContext('2d');</p>
<p class="p1">const overlay = document.getElementById('overlay');</p>
<p class="p1">const statusEl = document.getElementById('status');</p>
<p class="p1">const startBtn = document.getElementById('startBtn');</p>
<p class="p1">const downloadBtn = document.getElementById('downloadBtn');</p>
<p class="p1">const condMixSel = document.getElementById('condMix');</p>
<p class="p1">const delaySel = document.getElementById('delaySel');</p>
<p class="p1">const nTrialsSel = document.getElementById('nTrialsSel');</p>
<p class="p1">const pidEl = document.getElementById('pid');</p>
<p class="p2"><br></p>
<p class="p1">const W = canvas.width, H = canvas.height;</p>
<p class="p1">const CX = W/2, CY = H/2;</p>
<p class="p2"><br></p>
<p class="p1">let trials = [];</p>
<p class="p1">let trialN = 0;</p>
<p class="p1">let running = false;</p>
<p class="p1">let condition = 'baseline';</p>
<p class="p1">let blockPlan = [];</p>
<p class="p1">let delaySec = 4;</p>
<p class="p1">let trialsPerBlock = TRIALS_PER_BLOCK_DEFAULT;</p>
<p class="p2"><br></p>
<p class="p1">let phase = 'idle'; // 'fix','encode','delay','recall'</p>
<p class="p1">let current = null; // object holding trial info</p>
<p class="p1">let path = [];<span class="Apple-converted-space">      </span>// stylus samples during movement</p>
<p class="p1">let pointerDown = false;</p>
<p class="p2"><br></p>
<p class="p1">// ====== Utilities ======</p>
<p class="p1">function deg2rad(d){ return d*Math.PI/180; }</p>
<p class="p1">function rad2deg(r){ return r*180/Math.PI; }</p>
<p class="p1">function wrapDeg(a){ while(a&gt;180) a-=360; while(a&lt;=-180) a+=360; return a; }</p>
<p class="p1">function polarAt(angleDeg, r){ return [CX + r*Math.cos(deg2rad(angleDeg)), CY + r*Math.sin(deg2rad(angleDeg))]; }</p>
<p class="p1">function randChoice(a){ return a[Math.floor(Math.random()*a.length)]; }</p>
<p class="p1">function shuffle(a){ for(let i=a.length-1;i&gt;0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }</p>
<p class="p1">function now(){ return performance.now(); }</p>
<p class="p1">function sleep(ms){ return new Promise(r=&gt; setTimeout(r, ms)); }</p>
<p class="p2"><br></p>
<p class="p1">// ====== Drawing ======</p>
<p class="p1">function drawBase(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.clearRect(0,0,W,H);</p>
<p class="p1"><span class="Apple-converted-space">  </span>// home</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.arc(CX, CY, R_HOME, 0, 2*Math.PI);</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.fillStyle = '#222'; ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">  </span>// threshold circle (light guide)</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.arc(CX, CY, R_THRESH, 0, 2*Math.PI);</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.strokeStyle = 'rgba(0,0,0,0.08)'; ctx.lineWidth=1; ctx.stroke();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function drawTarget(angleDeg){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [tx,ty] = polarAt(angleDeg, TARGET_RADIUS);</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.arc(tx, ty, 10, 0, 2*Math.PI);</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.fillStyle = '#2a7'; ctx.fill();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function drawPath(samples){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(samples.length&lt;2) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.moveTo(samples[0].x, samples[0].y);</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=1;i&lt;samples.length;i++){</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.lineTo(samples[i].x, samples[i].y);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.strokeStyle = '#06f';</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.lineWidth = 3;</p>
<p class="p1"><span class="Apple-converted-space">  </span>ctx.stroke();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Conditions ======</p>
<p class="p1">const CONDS_ALL = ['baseline','verbal','vis','motor'];</p>
<p class="p2"><br></p>
<p class="p1">function makeBlockPlan(mix, n, fixedCond=null){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (fixedCond) return Array(n).fill(fixedCond);</p>
<p class="p1"><span class="Apple-converted-space">  </span>let pool = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(mix==='all') pool = CONDS_ALL;</p>
<p class="p1"><span class="Apple-converted-space">  </span>else if(mix==='baseline') pool=['baseline'];</p>
<p class="p1"><span class="Apple-converted-space">  </span>else if(mix==='verbal') pool=['verbal'];</p>
<p class="p1"><span class="Apple-converted-space">  </span>else if(mix==='vis') pool=['vis'];</p>
<p class="p1"><span class="Apple-converted-space">  </span>else if(mix==='motor') pool=['motor'];</p>
<p class="p1"><span class="Apple-converted-space">  </span>let arr = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=0;i&lt;n;i++){ arr.push(randChoice(pool)); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>return arr;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Visuospatial load ======</p>
<p class="p1">let visArray = null; let visProbe = null;</p>
<p class="p2"><br></p>
<p class="p1">function makeVisArray(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>// simple 4x4 grid with 5 colored squares</p>
<p class="p1"><span class="Apple-converted-space">  </span>let coords = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let r=0;r&lt;4;r++) for(let c=0;c&lt;4;c++) coords.push([r,c]);</p>
<p class="p1"><span class="Apple-converted-space">  </span>coords = shuffle(coords).slice(0,5);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const colors = ['#f33','#36f','#0a0','#fa0','#a0f','#0aa','#aaa','#333'];</p>
<p class="p1"><span class="Apple-converted-space">  </span>visArray = coords.map(([r,c])=&gt; ({r,c,color: randChoice(colors)}));</p>
<p class="p1"><span class="Apple-converted-space">  </span>const change = Math.random()&lt;0.5; // 50% change</p>
<p class="p1"><span class="Apple-converted-space">  </span>const idx = Math.floor(Math.random()*visArray.length);</p>
<p class="p1"><span class="Apple-converted-space">  </span>visProbe = JSON.parse(JSON.stringify(visArray));</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(change){</p>
<p class="p1"><span class="Apple-converted-space">    </span>let col = visProbe[idx].color;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let newCol = col; while(newCol===col) newCol = randChoice(colors);</p>
<p class="p1"><span class="Apple-converted-space">    </span>visProbe[idx].color = newCol;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>visProbe.change = change;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function showVisArray(ms){</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `&lt;div style="text-align:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;Remember this pattern&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="probeGrid"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const grid = overlay.querySelector('#probeGrid');</p>
<p class="p1"><span class="Apple-converted-space">  </span>grid.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">  </span>visArray.forEach(o=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cell=document.createElement('div'); cell.className='sq';</p>
<p class="p1"><span class="Apple-converted-space">    </span>cell.style.background=o.color;</p>
<p class="p1"><span class="Apple-converted-space">    </span>grid.appendChild(cell);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>setTimeout(()=&gt;{ overlay.style.display='none'; }, ms);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function visProbeQuery(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `&lt;div style="text-align:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;Was the pattern the SAME or DIFFERENT?&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="probeGrid" style="margin-bottom:10px;"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div style="display:flex; gap:10px; justify-content:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button id="sameBtn"&gt;Same&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button id="diffBtn"&gt;Different&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const grid = overlay.querySelector('#probeGrid');</p>
<p class="p1"><span class="Apple-converted-space">  </span>grid.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">  </span>visProbe.forEach(o=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cell=document.createElement('div'); cell.className='sq';</p>
<p class="p1"><span class="Apple-converted-space">    </span>cell.style.background=o.color;</p>
<p class="p1"><span class="Apple-converted-space">    </span>grid.appendChild(cell);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>return new Promise(resolve=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('#sameBtn').onclick = ()=&gt;{ overlay.style.display='none'; resolve('same'); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('#diffBtn').onclick = ()=&gt;{ overlay.style.display='none'; resolve('different'); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Motor tapping load ======</p>
<p class="p1">let requiredTaps = null; // e.g., [1,2,1,3]</p>
<p class="p1">let tapsSoFar = [];</p>
<p class="p2"><br></p>
<p class="p1">function makeTapPattern(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const len = 4;</p>
<p class="p1"><span class="Apple-converted-space">  </span>requiredTaps = Array.from({length:len}, ()=&gt; 1+Math.floor(Math.random()*3));</p>
<p class="p1"><span class="Apple-converted-space">  </span>tapsSoFar = [];</p>
<p class="p1">}</p>
<p class="p1">function showTapUI(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `&lt;div style="text-align:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;Please tap this pattern during the delay (use finger of your other hand):&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div style="margin-top:8px; font-size:18px"&gt;${requiredTaps.join(' - ')}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="motorTapArea"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="tapbtn" data-k="1"&gt;1&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="tapbtn" data-k="2"&gt;2&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="tapbtn" data-k="3"&gt;3&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="tapStatus" style="margin-top:8px; font-size:16px;"&gt;Progress: 0 / ${requiredTaps.length}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.querySelectorAll('.tapbtn').forEach(btn=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>btn.onclick = ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const k = Number(btn.dataset.k);</p>
<p class="p1"><span class="Apple-converted-space">      </span>tapsSoFar.push(k);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const p = overlay.querySelector('#tapStatus');</p>
<p class="p1"><span class="Apple-converted-space">      </span>p.textContent = `Progress: ${tapsSoFar.length} / ${requiredTaps.length}`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p1">function hideOverlay(){ overlay.style.display='none'; }</p>
<p class="p2"><br></p>
<p class="p1">// ====== Trial control ======</p>
<p class="p1">async function runTrial(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>phase = 'fix';</p>
<p class="p1"><span class="Apple-converted-space">  </span>path = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `Trial ${trialN+1}/${blockPlan.length} – place stylus in the centre circle`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// choose angle &amp; condition</p>
<p class="p1"><span class="Apple-converted-space">  </span>const angle = randChoice(ANGLES);</p>
<p class="p1"><span class="Apple-converted-space">  </span>condition = blockPlan[trialN];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>current = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>participant: (pidEl.value||''),</p>
<p class="p1"><span class="Apple-converted-space">    </span>trial: trialN+1,</p>
<p class="p1"><span class="Apple-converted-space">    </span>condition,</p>
<p class="p1"><span class="Apple-converted-space">    </span>target_deg: angle,</p>
<p class="p1"><span class="Apple-converted-space">    </span>delay_s: delaySec,</p>
<p class="p1"><span class="Apple-converted-space">    </span>encode_time:null, recall_time:null,</p>
<p class="p1"><span class="Apple-converted-space">    </span>encode_angle_deg:null, recall_angle_deg:null,</p>
<p class="p1"><span class="Apple-converted-space">    </span>error_deg:null,</p>
<p class="p1"><span class="Apple-converted-space">    </span>visAcc:null, // probe accuracy (1/0)</p>
<p class="p1"><span class="Apple-converted-space">    </span>motorTapsMatch:null, // compliance (1/0)</p>
<p class="p1"><span class="Apple-converted-space">    </span>samples_encode:[], samples_recall:[]</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ===== ENCODE =====</p>
<p class="p1"><span class="Apple-converted-space">  </span>await sleep(400); // settle</p>
<p class="p1"><span class="Apple-converted-space">  </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">  </span>drawTarget(angle);</p>
<p class="p1"><span class="Apple-converted-space">  </span>await sleep(TARGET_MS);</p>
<p class="p1"><span class="Apple-converted-space">  </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `Trial ${current.trial}: quick flick TOWARD the (vanished) target, then back to centre`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>phase = 'encode';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const encodeDeadline = now() + 3000;</p>
<p class="p1"><span class="Apple-converted-space">  </span>await waitForStroke('encode', encodeDeadline);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// short pause to return to center</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `Return to centre…`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>await sleep(RETURN_MS);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ===== DELAY (with possible load) =====</p>
<p class="p1"><span class="Apple-converted-space">  </span>phase = 'delay';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(condition==='verbal'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.innerHTML = `&lt;div&gt;Please repeat softly: “the… the… the…” until the screen changes.&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else if(condition==='vis'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>makeVisArray();</p>
<p class="p1"><span class="Apple-converted-space">    </span>showVisArray(1200);</p>
<p class="p1"><span class="Apple-converted-space">    </span>await sleep(1200);</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else if(condition==='motor'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>makeTapPattern();</p>
<p class="p1"><span class="Apple-converted-space">    </span>showTapUI();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `Hold in memory – delay ${delaySec}s`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>await sleep(delaySec*1000);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(condition==='verbal') hideOverlay();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(condition==='motor'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>hideOverlay();</p>
<p class="p1"><span class="Apple-converted-space">    </span>// simple compliance: full sequence entered and in order</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ok = requiredTaps.length===tapsSoFar.length &amp;&amp; requiredTaps.every((v,i)=&gt; v===tapsSoFar[i]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>current.motorTapsMatch = ok ? 1 : 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ===== RECALL =====</p>
<p class="p1"><span class="Apple-converted-space">  </span>phase = 'recall';</p>
<p class="p1"><span class="Apple-converted-space">  </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `RECALL: reproduce the SAME direction (quick flick)`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const recallDeadline = now() + 5000;</p>
<p class="p1"><span class="Apple-converted-space">  </span>await waitForStroke('recall', recallDeadline);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ===== Visuospatial probe =====</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(condition==='vis'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ans = await visProbeQuery();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const corr = (ans==='same' &amp;&amp; !visProbe.change) || (ans==='different' &amp;&amp; visProbe.change);</p>
<p class="p1"><span class="Apple-converted-space">    </span>current.visAcc = corr ? 1 : 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// compute error &amp; store</p>
<p class="p1"><span class="Apple-converted-space">  </span>current.error_deg = (current.recall_angle_deg==null) ? null :</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapDeg(current.recall_angle_deg - current.target_deg);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>trials.push(current);</p>
<p class="p1"><span class="Apple-converted-space">  </span>trialN++;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function waitForStroke(which, deadline){</p>
<p class="p1"><span class="Apple-converted-space">  </span>return new Promise(resolve=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tick = ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(now()&gt;deadline) resolve();</p>
<p class="p1"><span class="Apple-converted-space">      </span>else requestAnimationFrame(tick);</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(tick);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const chk = setInterval(()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(which==='encode' &amp;&amp; current.encode_angle_deg!=null){ clearInterval(chk); resolve(); }</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(which==='recall' &amp;&amp; current.recall_angle_deg!=null){ clearInterval(chk); resolve(); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}, 50);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Pointer events ======</p>
<p class="p1">canvas.addEventListener('pointerdown', e=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(phase==='encode' || phase==='recall'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>pointerDown = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>path = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>recordSample(e);</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawPath(path);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p1">canvas.addEventListener('pointermove', e=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(pointerDown &amp;&amp; (phase==='encode' || phase==='recall')){</p>
<p class="p1"><span class="Apple-converted-space">    </span>recordSample(e);</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawPath(path);</p>
<p class="p1"><span class="Apple-converted-space">    </span>// compute angle on first threshold crossing</p>
<p class="p1"><span class="Apple-converted-space">    </span>const {x,y} = path[path.length-1];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dx = x - CX, dy = y - CY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const r = Math.hypot(dx,dy);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(r&gt;=R_THRESH){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const ang = wrapDeg(rad2deg(Math.atan2(dy,dx)));</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(phase==='encode' &amp;&amp; current.encode_angle_deg==null){</p>
<p class="p1"><span class="Apple-converted-space">        </span>current.encode_angle_deg = ang;</p>
<p class="p1"><span class="Apple-converted-space">        </span>current.encode_time = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(phase==='recall' &amp;&amp; current.recall_angle_deg==null){</p>
<p class="p1"><span class="Apple-converted-space">        </span>current.recall_angle_deg = ang;</p>
<p class="p1"><span class="Apple-converted-space">        </span>current.recall_time = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p1">canvas.addEventListener('pointerup', e=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(pointerDown){</p>
<p class="p1"><span class="Apple-converted-space">    </span>pointerDown=false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>recordSample(e);</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawBase(); drawPath(path);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function recordSample(e){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const x = (e.clientX - rect.left) * (canvas.width/rect.width);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const y = (e.clientY - rect.top)<span class="Apple-converted-space">  </span>* (canvas.height/rect.height);</p>
<p class="p1"><span class="Apple-converted-space">  </span>path.push({x,y,t:performance.now(), type:e.pointerType});</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(phase==='encode') current.samples_encode.push({x,y,t:performance.now()});</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(phase==='recall') current.samples_recall.push({x,y,t:performance.now()});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Block + Session control ======</p>
<p class="p1">async function runBlock(nTrials = trialsPerBlock, label = 'Block', fixedCond=null){</p>
<p class="p1"><span class="Apple-converted-space">  </span>running = true;</p>
<p class="p1"><span class="Apple-converted-space">  </span>trialN = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>trials = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>delaySec = Number(delaySel.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>trialsPerBlock = Number(nTrialsSel.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const n = (nTrials===trialsPerBlock) ? trialsPerBlock : nTrials;</p>
<p class="p1"><span class="Apple-converted-space">  </span>blockPlan = makeBlockPlan(condMixSel.value, n, fixedCond);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>startBtn.disabled = true; downloadBtn.disabled = true;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; n; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>await runTrial();</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawBase();</p>
<p class="p1"><span class="Apple-converted-space">    </span>statusEl.textContent = `Done ${label.toLowerCase()} trial ${i+1}/${n}`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>await sleep(400);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>running = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>startBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>downloadBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>statusEl.textContent = `${label} complete. You can download CSV.`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// End screen</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display = 'flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div style="max-width:560px; text-align:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;${label} complete&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p&gt;You can now download your data as a CSV file.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="endDownloadBtn"&gt;Download CSV&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="againBtn"&gt;Repeat this ${label.toLowerCase()}&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="homeBtn"&gt;Back to instructions&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="note"&gt;Participant: ${pidEl.value||'(none)'} • Condition: ${fixedCond?fixedCond:condMixSel.value} • Trials: ${n} • Delay: ${delaySec}s&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('endDownloadBtn').onclick = ()=&gt; downloadCSV();</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('againBtn').onclick = ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display='none';</p>
<p class="p1"><span class="Apple-converted-space">    </span>runBlock(n, label, fixedCond);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('homeBtn').onclick = ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display='none';</p>
<p class="p1"><span class="Apple-converted-space">    </span>showIntro();</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function runSessionBlocked(order = ['baseline','verbal','vis','motor'], nTrials = null){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const n = nTrials ?? Number(nTrialsSel.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i=0; i&lt;order.length; i++){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cond = order[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Block instructions</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="max-width:680px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;Next block: ${cond.toUpperCase()}&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;During the delay you will ${</p>
<p class="p1"><span class="Apple-converted-space">          </span>cond==='baseline' ? 'do nothing extra.' :</p>
<p class="p1"><span class="Apple-converted-space">          </span>cond==='verbal' <span class="Apple-converted-space">  </span>? 'softly repeat “the… the… the…”' :</p>
<p class="p1"><span class="Apple-converted-space">          </span>cond==='vis'<span class="Apple-converted-space">      </span>? 'remember a small coloured pattern' :</p>
<p class="p1"><span class="Apple-converted-space">                              </span>'tap a short on-screen pattern with your other hand'</p>
<p class="p1"><span class="Apple-converted-space">        </span>}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;Task each trial: flick the stylus toward the brief target, wait, then reproduce the &lt;b&gt;same direction&lt;/b&gt; when prompted (no target shown).&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="goBlock"&gt;Start ${cond} block (${n} trials)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>await new Promise(res=&gt; overlay.querySelector('#goBlock').onclick = ()=&gt;{ overlay.style.display='none'; res(); });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>await runBlock(n, `Block: ${cond}`, cond);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Session summary</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div style="max-width:560px; text-align:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;Session complete&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p&gt;You’ve finished all blocks. Download your data before exiting.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="endDownloadBtn2"&gt;Download CSV&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="homeBtn2"&gt;Back to instructions&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="note"&gt;Participant: ${pidEl.value||'(none)'}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('endDownloadBtn2').onclick = ()=&gt; downloadCSV();</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('homeBtn2').onclick = ()=&gt;{ overlay.style.display='none'; showIntro(); };</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== CSV ======</p>
<p class="p1">function toCSV(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const fields = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>'participant','trial','condition','target_deg','delay_s',</p>
<p class="p1"><span class="Apple-converted-space">    </span>'encode_angle_deg','recall_angle_deg','error_deg',</p>
<p class="p1"><span class="Apple-converted-space">    </span>'visAcc','motorTapsMatch','encode_time','recall_time'</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p1"><span class="Apple-converted-space">  </span>let rows = [fields.join(',')];</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(const r of trials){</p>
<p class="p1"><span class="Apple-converted-space">    </span>rows.push(fields.map(k=&gt; (r[k]==null?'':r[k])).join(','));</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>return rows.join('\n');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function downloadCSV(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const blob = new Blob([toCSV()], {type:'text/csv'});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const a = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const id = pidEl.value ? `_PID-${pidEl.value}` : '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.href = url; a.download = `mwm_reach${id}_${Date.now()}.csv`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.body.appendChild(a); a.click(); a.remove();</p>
<p class="p1"><span class="Apple-converted-space">  </span>URL.revokeObjectURL(url);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ====== Intro &amp; Toolbar actions ======</p>
<p class="p1">function showIntro(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.style.display='flex';</p>
<p class="p1"><span class="Apple-converted-space">  </span>overlay.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div style="max-width:700px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;Motor Working Memory – Delayed Reach&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;ol&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;li&gt;Keep the stylus in the centre circle.&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;li&gt;A target dot briefly appears—make a quick flick &lt;b&gt;toward&lt;/b&gt; it and return to centre.&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;li&gt;During the delay, depending on the block: none / verbal / visuospatial / motor tapping.&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;li&gt;Reproduce the &lt;b&gt;same direction&lt;/b&gt; without the target when prompted.&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/ol&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="startDemoBtn"&gt;Quick demo (5 random trials)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="startBlockBtn"&gt;Single block (use toolbar settings)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="startSessionBtn"&gt;Blocked session (Baseline → Verbal → Vis → Motor)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="note" style="margin-top:10px;"&gt;Tip: use Apple Pencil if available; hold the iPad steady.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('startDemoBtn').onclick <span class="Apple-converted-space">  </span>= ()=&gt;{ overlay.style.display='none'; runBlock(5, 'Demo'); };</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('startBlockBtn').onclick<span class="Apple-converted-space">  </span>= ()=&gt;{ overlay.style.display='none'; runBlock(Number(nTrialsSel.value), 'Block'); };</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('startSessionBtn').onclick= ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display='none';</p>
<p class="p1"><span class="Apple-converted-space">    </span>runSessionBlocked(['baseline','verbal','vis','motor'], Number(nTrialsSel.value));</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Toolbar start (manual)</p>
<p class="p1">startBtn.onclick = ()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!running) runBlock(Number(nTrialsSel.value), 'Block');</p>
<p class="p1">};</p>
<p class="p1">downloadBtn.onclick = downloadCSV;</p>
<p class="p2"><br></p>
<p class="p1">// ====== Init ======</p>
<p class="p1">drawBase();</p>
<p class="p1">statusEl.textContent = 'Idle – open the instructions overlay to begin';</p>
<p class="p1">showIntro();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
